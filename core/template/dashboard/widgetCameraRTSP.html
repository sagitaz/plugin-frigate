<script src="plugins/frigate/core/template/dashboard/hls-1.5.13.light.min.js"></script>
<div class="eqLogic eqLogic-widget  allowResize allowReorderCmd frigate_widget frigate #custom_layout# #eqLogic_class# #class#"
    data-version="#version#" data-eqLogic_id="#id#" data-eqLogic_uid="#uid#" data-eqType="#eqType#" data-tags="#tags#"
    style="text-align:center; border:#border#; border-radius:#border-radius#; color: #color#;width: #width#;height: #height#;#style#;">


    <center class="widget-name">
        <span class="reportModeVisible">#name_display# <span class="object_name">#object_name#</span></span>
        <a href="#eqLink#" class="reportModeHidden">#name_display# <span class="object_name">#object_name#</span></a>
    </center>

    <video id="video" data-eqLogic_id="#id#" controls width="640" height="360"></video>

    <script>
        $.ajax({
            type: "POST",
            url: "plugins/camera/core/ajax/camera.ajax.php",
            data: {
                action: "stream",
                id: "#id#"
            },
            global: false,
            dataType: 'json',
            error: function (request, status, error) {
                handleAjaxError(request, status, error);
            },
            success: function (data) {
                if (data.state != 'ok') {
                    $('#div_alert').showAlert({ message: data.result, level: 'danger' });
                    return;
                }
                try {
                    if (Hls.isSupported()) {
                        var video = document.getElementById('video');
                        var hls = new Hls();
                        hls.loadSource('/plugins/frigate/core/data/output.m3u8');
                        hls.attachMedia(video);
                        hls.on(Hls.Events.MANIFEST_PARSED, function () {
                            video.play();
                        });
                    } else if (video.canPlayType('application/vnd.apple.mpegurl')) {
                        video.src = '/plugins/frigate/core/data/output.m3u8';
                        video.addEventListener('canplay', function () {
                            video.play();
                        });
                    }
                } catch (e) {

                }
            }
        });
    </script>
</div>